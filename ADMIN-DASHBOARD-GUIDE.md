# 🔐 관리자 대시보드 가이드

## 개요

관리자 로그인 시스템과 통계 대시보드를 추가했습니다. A/B 실험 데이터를 시각화하고 분석할 수 있습니다.

## 기능

### 1. 관리자 인증 시스템

- **토큰 기반 인증**: HMAC-SHA256 서명 토큰
- **HttpOnly 쿠키**: XSS 공격 방지
- **세션 유지**: 7일간 유효
- **미들웨어 보호**: `/admin` 경로 자동 보호

### 2. 통계 대시보드

- **날짜 범위 필터**: 시작일/종료일 선택
- **일자별 집계**: 페이지뷰, 광고노출 추적
- **A/B 실험 비교**: 버전별 성과 비교
- **그래프 시각화**: 
  - 라인차트: 일자별 페이지뷰 트렌드
  - 바차트: 일자별 광고노출 비교

## 설정 방법

### 1. 환경 변수 설정

`.env.local` 파일에 다음 변수를 설정하세요:

```env
ADMIN_PASSWORD=your_admin_password_here
ADMIN_SECRET=your_long_random_secret_key_here
```

**중요**: 
- `ADMIN_PASSWORD`: 관리자 로그인 비밀번호
- `ADMIN_SECRET`: 토큰 서명용 키 (길게, 랜덤하게 생성 권장)

### 2. 기본 비밀번호

현재 `.env.local`에 설정된 기본 비밀번호:
- **비밀번호**: `admin123`
- **SECRET**: 자동 생성됨

**운영 환경에서는 반드시 변경하세요!**

## 사용 방법

### 1. 관리자 로그인

1. 브라우저에서 `/admin/login` 접속
2. 관리자 비밀번호 입력
3. 로그인 버튼 클릭
4. 자동으로 `/admin/dashboard`로 이동

### 2. 대시보드 사용

#### 날짜 범위 선택
- 시작일/종료일 직접 입력
- "최근 7일" / "최근 30일" 빠른 선택
- "적용" 버튼으로 필터 적용

#### 통계 확인
- **요약 카드**: A/B 버전별 요약 통계
- **라인차트**: 일자별 페이지뷰 트렌드
- **바차트**: 일자별 광고노출 비교
- **원시 집계 테이블**: 실험별 상세 통계

### 3. 로그아웃

대시보드 우측 상단 "로그아웃" 버튼 클릭

## 파일 구조

```
app/
├── lib/
│   ├── adminAuth.js          # 인증 유틸리티 (토큰 생성/검증)
│   └── analyticsStore.js     # 통계 저장소 (일자별 집계)
├── api/
│   ├── admin/
│   │   ├── login/route.js    # 로그인 API
│   │   └── logout/route.js   # 로그아웃 API
│   └── stats/route.js        # 통계 API (관리자 보호)
├── admin/
│   ├── login/page.js         # 로그인 페이지
│   └── dashboard/page.js     # 대시보드 페이지
middleware.js                  # /admin 경로 보호
```

## 보안 기능

### 1. 미들웨어 보호

- `/admin/*` 경로는 자동으로 보호됨
- 로그인하지 않은 사용자는 `/admin/login`으로 리다이렉트
- 로그인 페이지는 예외

### 2. API 보호

- `/api/stats`는 관리자만 접근 가능
- 인증되지 않은 요청은 401 반환

### 3. 쿠키 보안

- `httpOnly`: JavaScript 접근 불가 (XSS 방지)
- `sameSite: lax`: CSRF 공격 완화
- `secure`: 프로덕션에서 HTTPS만 허용

## 데이터 저장

### 현재: 인메모리 저장

- 서버 메모리에 데이터 저장
- 서버 재시작/배포 시 데이터 초기화
- 개발/테스트용으로 적합

### 향후 확장 가능

- **Supabase**: PostgreSQL 기반 영구 저장
- **Redis**: 고성능 캐시/세션 저장
- **MongoDB**: NoSQL 데이터베이스

## 주의사항

### 1. 환경 변수 보안

- `.env.local`은 Git에 커밋하지 마세요 (`.gitignore`에 포함됨)
- Vercel 배포 시 환경 변수 별도 설정 필요

### 2. 비밀번호 관리

- 기본 비밀번호(`admin123`)는 운영 환경에서 반드시 변경
- 강력한 비밀번호 사용 권장

### 3. 데이터 지속성

- 현재는 인메모리 저장이므로 서버 재시작 시 데이터 손실
- 운영 환경에서는 DB 연동 필수

## Vercel 배포 시 환경 변수 설정

1. Vercel 대시보드 > Settings > Environment Variables
2. 다음 변수 추가:
   - `ADMIN_PASSWORD`: 관리자 비밀번호
   - `ADMIN_SECRET`: 토큰 서명 키

## 문제 해결

### 로그인이 안 될 때

1. `.env.local` 파일 확인
2. 환경 변수가 올바르게 설정되었는지 확인
3. 서버 재시작 후 다시 시도

### 대시보드에 데이터가 없을 때

1. 이벤트가 기록되고 있는지 확인
2. 날짜 범위가 올바른지 확인
3. 서버 재시작으로 인한 데이터 초기화 가능성 확인

### 401 Unauthorized 오류

1. 로그인 상태 확인
2. 쿠키가 올바르게 설정되었는지 확인
3. 브라우저 개발자 도구 > Application > Cookies 확인

## 다음 단계

### 수익 계산 기능 추가

원하면 다음 기능을 추가할 수 있습니다:
- 날짜별 수익 입력
- RPM 자동 계산
- A/B 승자 자동 판정 (통계적 유의성 검증)

## 참고

- AdSense 정책 준수: 클릭 추적 금지, 노출/페이지뷰만 추적
- 모든 통계는 서버 사이드에서 집계
- 클라이언트에서 직접 데이터 접근 불가

